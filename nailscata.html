<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NailsCata - Agenda tu Cita</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fce4ec; /* Light pink background */
            line-height: 1.6;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 25px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.1); /* Pink shadow */
        }
        h1, h2 {
            color: #d81b60; /* Darker pink */
            text-align: center;
            margin-bottom: 20px;
        }
        .header-section {
            background-color: #f8bbd0; /* Medium pink */
            padding: 20px 0;
            text-align: center;
            color: white;
        }
        .header-section h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 0;
        }
        .header-section p {
            font-size: 1.1em;
        }
        .nav-link {
            padding: 8px 15px;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }
        .nav-link:hover {
            background-color: #ec4899; /* Bright pink */
        }
        .hero-section {
            background: url('https://via.placeholder.com/1200x400') no-repeat center center/cover;
            color: white;
            padding: 80px 20px;
            text-align: center;
        }
        .hero-section h2 {
            font-size: 3em;
            margin-bottom: 15px;
            color: white;
        }
        .hero-section p {
            font-size: 1.3em;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        .btn-primary {
            background-color: #d81b60;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #ad1457;
        }
        .section-heading {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 30px;
            color: #d81b60;
            text-align: center;
        }
        .service-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 25px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .service-card:hover {
            transform: translateY(-5px);
        }
        .service-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8bbd0;
            color: white;
            border-radius: 8px;
        }
        .calendar-header button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .calendar-header button:hover {
            background-color: #ec4899;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }
        .calendar-day-header {
            font-weight: bold;
            color: #d81b60;
            padding: 10px 0;
            background-color: #ffebee;
            border-radius: 4px;
        }
        .calendar-day {
            padding: 15px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            font-weight: 500;
            color: #555;
        }
        .calendar-day.current-month:hover {
            background-color: #fce4ec;
            transform: scale(1.05);
        }
        .calendar-day.selected {
            background-color: #d81b60;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(216, 27, 96, 0.3);
        }
        .calendar-day.past-date {
            background-color: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
        }
        .time-slot {
            padding: 10px 15px;
            margin: 5px;
            background-color: #ffebee;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: inline-block;
            font-weight: 500;
            color: #d81b60;
        }
        .time-slot:not(.booked):hover {
            background-color: #f8bbd0;
            transform: translateY(-2px);
            color: white;
        }
        .time-slot.selected-time {
            background-color: #d81b60;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(216, 27, 96, 0.3);
        }
        .time-slot.booked {
            background-color: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .form-input {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 15px;
            border: 1px solid #f8bbd0;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
        }
        .form-input:focus {
            outline: none;
            border-color: #d81b60;
            box-shadow: 0 0 0 2px rgba(216, 27, 96, 0.2);
        }
        .error-message {
            color: #ef4444;
            font-size: 0.9em;
            margin-top: -10px;
            margin-bottom: 10px;
            text-align: center;
        }
        .form-submit-btn {
            background-color: #d81b60;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .form-submit-btn:hover {
            background-color: #ad1457;
        }
        .form-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            font-weight: 500;
            font-size: 1.1em;
        }
        .form-message.success {
            background-color: #d1fae5; /* Light green */
            color: #065f46; /* Dark green */
        }
        .form-message.error {
            background-color: #fee2e2; /* Light red */
            color: #991b1b; /* Dark red */
        }
        footer {
            background-color: #f8bbd0;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }
        footer a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
        }
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-pink-400 p-4">
        <nav class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-white text-2xl font-bold">NailsCata</a>
            <div class="hidden md:flex space-x-4">
                <a href="#services" class="text-white nav-link">Servicios</a>
                <a href="#appointment" class="text-white nav-link">Agendar Cita</a>
                <a href="#contact" class="text-white nav-link">Contacto</a>
            </div>
            <button class="md:hidden mobile-menu-button text-white">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </nav>
        <div class="mobile-menu hidden md:hidden bg-pink-400">
            <a href="#services" class="block py-2 px-4 text-sm text-white hover:bg-pink-500">Servicios</a>
            <a href="#appointment" class="block py-2 px-4 text-sm text-white hover:bg-pink-500">Agendar Cita</a>
            <a href="#contact" class="block py-2 px-4 text-sm text-white hover:bg-pink-500">Contacto</a>
        </div>
    </header>

    <section class="hero-section text-white text-center py-20" style="background-image: url('https://i.imgur.com/8Q9j7Z9.png');">
        <div class="container mx-auto">
            <h2 class="text-5xl font-bold mb-4">Transforma tus Uñas y Pestañas</h2>
            <p class="text-xl mb-8">Expertos en belleza, dedicados a realzar tu estilo y confianza.</p>
            <a href="#appointment" class="btn-primary inline-block">Agendar mi Cita Ahora</a>
        </div>
    </section>

    <section id="services" class="py-16 bg-white">
        <div class="container mx-auto">
            <h2 class="section-heading">Nuestros Servicios</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="service-card">
                    <img src="https://i.imgur.com/eB3jV4F.png" alt="Uñas Acrílicas" class="mx-auto">
                    <h3 class="text-xl font-semibold text-pink-600 mb-2">Uñas Acrílicas</h3>
                    <p class="text-gray-600">Extensiones duraderas y diseños personalizados para un look espectacular.</p>
                </div>
                <div class="service-card">
                    <img src="https://i.imgur.com/1G6j3Kj.png" alt="Manicura y Pedicura" class="mx-auto">
                    <h3 class="text-xl font-semibold text-pink-600 mb-2">Manicura y Pedicura</h3>
                    <p class="text-gray-600">Cuidado completo para tus manos y pies, con esmaltado y tratamientos.</p>
                </div>
                <div class="service-card">
                    <img src="https://i.imgur.com/N5iW1gI.png" alt="Lifting de Pestañas" class="mx-auto">
                    <h3 class="text-xl font-semibold text-pink-600 mb-2">Lifting de Pestañas</h3>
                    <p class="text-gray-600">Riza y eleva tus pestañas naturales para una mirada más abierta y definida.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="appointment" class="py-16 bg-pink-50">
        <div class="container mx-auto">
            <h2 class="section-heading">Agenda tu Cita</h2>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <p class="text-center text-gray-700 mb-6">Selecciona la fecha y hora que mejor se adapte a ti.</p>
                
                <div class="calendar-section mb-8">
                    <h3 class="text-lg font-semibold text-pink-600 mb-4 text-center">Selecciona Fecha y Hora:</h3>
                    
                    <div class="calendar-header">
                        <button id="prevMonth" class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-1 px-3 rounded text-sm">&lt;</button>
                        <h4 id="currentMonthYear" class="text-xl font-semibold"></h4>
                        <button id="nextMonth" class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-1 px-3 rounded text-sm">&gt;</button>
                    </div>
                    
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Lun</div>
                        <div class="calendar-day-header">Mar</div>
                        <div class="calendar-day-header">Mié</div>
                        <div class="calendar-day-header">Jue</div>
                        <div class="calendar-day-header">Vie</div>
                        <div class="calendar-day-header">Sáb</div>
                        <div class="calendar-day-header">Dom</div>
                        <div id="calendar"></div>
                    </div>
                    <div id="dateError" class="error-message hidden">Por favor, selecciona una fecha.</div>
                </div>

                <div class="time-slots-section mb-8">
                    <h3 class="text-lg font-semibold text-pink-600 mb-4 text-center">Horarios disponibles para <span id="displaySelectedDate">la fecha seleccionada</span>:</h3>
                    <div id="timeSlots" class="flex flex-wrap justify-center gap-2">
                        </div>
                    <div id="timeError" class="error-message hidden">Por favor, selecciona una hora.</div>
                </div>

                <form id="appointmentForm" class="space-y-4">
                    <input type="hidden" id="selectedDate" name="fecha">
                    <input type="hidden" id="selectedTime" name="hora">

                    <div>
                        <label for="name" class="block text-gray-700 text-sm font-bold mb-2">Tu Nombre:</label>
                        <input type="text" id="name" name="nombre" class="form-input" placeholder="Nombre Completo" required>
                    </div>
                    <div>
                        <label for="telefono" class="block text-gray-700 text-sm font-bold mb-2">Tu Teléfono (ej: +54911xxxx):</label>
                        <input type="tel" id="telefono" name="telefono" class="form-input" placeholder="+54911xxxx" required>
                    </div>
                     <div>
                        <label for="service" class="block text-gray-700 text-sm font-bold mb-2">Servicio:</label>
                        <select id="service" name="servicio" class="form-input" required>
                            <option value="">Selecciona un servicio</option>
                            <option value="Uñas Acrilicas">Uñas Acrílicas</option>
                            <option value="Manicura y Pedicura">Manicura y Pedicura</option>
                            <option value="Lifting de Pestañas">Lifting de Pestañas</option>
                            <option value="Service">Service</option>
                        </select>
                    </div>
                    <div>
                        <label for="message" class="block text-gray-700 text-sm font-bold mb-2">Notas adicionales (opcional):</label>
                        <textarea id="message" name="message" class="form-input" rows="3" placeholder="Alguna preferencia o detalle..."></textarea>
                    </div>
                    
                    <div id="formMessage" class="form-message hidden"></div>

                    <button type="submit" class="form-submit-btn">Agendar Cita</button>
                </form>
            </div>
        </div>
    </section>

    <section id="contact" class="py-16 bg-white">
        <div class="container mx-auto text-center">
            <h2 class="section-heading">Contáctanos</h2>
            <p class="text-gray-700 mb-6">¿Tienes alguna pregunta? Ponte en contacto con nosotros.</p>
            <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-8">
                <p class="text-lg"><i class="fas fa-phone-alt text-pink-600 mr-2"></i> +54 9 11 1234 5678</p>
                <p class="text-lg"><i class="fas fa-envelope text-pink-600 mr-2"></i> info@nailscata.com</p>
                <p class="text-lg"><i class="fas fa-map-marker-alt text-pink-600 mr-2"></i> Buenos Aires, Argentina</p>
            </div>
            <div class="flex justify-center space-x-6 mt-8 text-2xl">
                <a href="#" class="text-pink-600 hover:text-pink-800"><i class="fab fa-instagram"></i></a>
                <a href="#" class="text-pink-600 hover:text-pink-800"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="text-pink-600 hover:text-pink-800"><i class="fab fa-facebook"></i></a>
            </div>
        </div>
    </section>

    <footer class="bg-pink-400 py-6">
        <div class="container mx-auto">
            <p>&copy; 2025 NailsCata. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        // Mobile Menu Toggle
        const btn = document.querySelector('button.mobile-menu-button');
        const menu = document.querySelector('.mobile-menu');

        btn.addEventListener('click', () => {
            menu.classList.toggle('hidden');
        });

        // Close mobile menu on link click
        menu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                menu.classList.add('hidden');
            });
        });

        // Smooth scroll for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();

                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Dynamic Calendar and Appointment Form Logic
        const calendarEl = document.getElementById('calendar');
        const currentMonthYearEl = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const selectedDateInput = document.getElementById('selectedDate');
        const displaySelectedDateEl = document.getElementById('displaySelectedDate');
        const timeSlotsEl = document.getElementById('timeSlots');
        const selectedTimeInput = document.getElementById('selectedTime');
        const appointmentForm = document.getElementById('appointmentForm');
        const dateErrorEl = document.getElementById('dateError');
        const timeErrorEl = document.getElementById('timeError');
        const formMessageEl = document.getElementById('formMessage');

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let occupiedSlotsMap = {}; // Declarada globalmente para ser accesible

        // ¡MUY IMPORTANTE! Asegúrate de que esta URL sea la de tu backend en Render.
        const API_BASE_URL = 'https://cata-backend-5z45.onrender.com'; 

        // Function to fetch occupied dates and times from backend
        // Esta función sigue siendo necesaria para pintar los días en el calendario si un día completo está ocupado
        // O para mostrar un conteo de citas, aunque la lógica principal de disponibilidad la lleva ahora fetchTimeSlots
        async function fetchOccupiedSlots() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/appointments`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const occupiedAppointments = await response.json();
                console.log("Citas ocupadas:", occupiedAppointments);

                const map = {}; 
                // Asegúrate de que 'reservedSlots' sea la propiedad correcta de tu respuesta del backend
                if (occupiedAppointments && occupiedAppointments.reservedSlots) {
                    occupiedAppointments.reservedSlots.forEach(app => {
                        const date = app.fecha; 
                        const time = app.hora; 
                        if (!map[date]) {
                            map[date] = new Set();
                        }
                        map[date].add(time);
                    });
                }
                return map;
            } catch (error) {
                console.error("Error fetching occupied slots:", error);
                return {}; // Return empty object on error
            }
        }

        async function renderCalendar() {
            calendarEl.innerHTML = '';
            timeSlotsEl.innerHTML = ''; // Clear time slots when rendering a new month
            selectedDateInput.value = ''; // Clear selected date input
            selectedTimeInput.value = ''; // Clear selected time input
            displaySelectedDateEl.textContent = 'la fecha seleccionada'; // Reset display text
            dateErrorEl.classList.add('hidden');
            timeErrorEl.classList.add('hidden');
            formMessageEl.classList.add('hidden');

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize today to start of day

            currentMonthYearEl.textContent = firstDayOfMonth.toLocaleDateString('es-ES', {
                month: 'long',
                year: 'numeric'
            });

            // Asigna el resultado a la variable global (esto se usa más para pintar el calendario con info general)
            occupiedSlotsMap = await fetchOccupiedSlots(); 

            // Fill leading empty days
            const startDay = (firstDayOfMonth.getDay() + 6) % 7; // Adjust to start on Monday (0=Mon, 6=Sun)
            for (let i = 0; i < startDay; i++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('calendar-day');
                calendarEl.appendChild(dayEl);
            }

            // Fill days of the month
            for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateString = date.toISOString().split('T')[0]; // YYYY-MM-DD
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                dayEl.classList.add('calendar-day');

                if (date < today) {
                    dayEl.classList.add('past-date');
                } else {
                    dayEl.classList.add('current-month');
                    dayEl.dataset.date = dateString;
                    dayEl.addEventListener('click', async () => {
                        // Clear previous selection
                        document.querySelectorAll('.calendar-day.selected').forEach(el => {
                            el.classList.remove('selected');
                        });
                        dayEl.classList.add('selected');
                        selectedDateInput.value = dateString;
                        displaySelectedDateEl.textContent = date.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });
                        timeErrorEl.classList.add('hidden'); // Hide time error on new date selection
                        
                        // *** LLAMADA ACTUALIZADA A fetchTimeSlots ***
                        await fetchTimeSlots(dateString); // YA NO PASAMOS occupiedTimesForDate
                    });
                }
                calendarEl.appendChild(dayEl);
            }
        }

        // *** FUNCIÓN fetchTimeSlots MODIFICADA ***
        async function fetchTimeSlots(dateString) { // Eliminamos occupiedTimesForDate de los parámetros
            timeSlotsEl.innerHTML = '<p class="text-gray-500">Cargando horarios...</p>'; // Mostrar mensaje de carga
            selectedTimeInput.value = ''; // Limpiar cualquier hora seleccionada previamente
            
            try {
                // Llama a la ruta del backend para obtener los horarios disponibles según el día
                const response = await fetch(`${API_BASE_URL}/api/available-times?date=${dateString}`);
                if (!response.ok) {
                    const errorData = await response.json(); 
                    throw new Error(errorData.error || `Error HTTP! estado: ${response.status}`);
                }
                const data = await response.json();
                const availableTimesFromBackend = data.availableTimes || []; // Obtén los horarios del backend

                timeSlotsEl.innerHTML = ''; // Limpiar ranuras de tiempo anteriores

                if (availableTimesFromBackend.length === 0) {
                    timeSlotsEl.innerHTML = '<p class="text-gray-500">No hay horarios disponibles para este día.</p>';
                    return;
                }

                const now = new Date();
                const selectedDate = new Date(dateString);
                
                availableTimesFromBackend.forEach(slot => { // Itera sobre los horarios recibidos del backend
                    const timeSlotEl = document.createElement('div');
                    timeSlotEl.classList.add('time-slot');
                    timeSlotEl.textContent = slot;
                    timeSlotEl.dataset.time = slot;

                    const [hours, minutes] = slot.split(':').map(Number);
                    const slotDateTime = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate(), hours, minutes);

                    // Verifica si el horario ya pasó en el día actual (el backend ya debería filtrar los ocupados)
                    if (slotDateTime < now && dateString === now.toISOString().split('T')[0]) {
                        timeSlotEl.classList.add('booked');
                    } else {
                        timeSlotEl.addEventListener('click', () => {
                            document.querySelectorAll('.time-slot.selected-time').forEach(el => {
                                el.classList.remove('selected-time');
                            });
                            timeSlotEl.classList.add('selected-time');
                            selectedTimeInput.value = slot;
                            timeErrorEl.classList.add('hidden'); // Oculta el error de tiempo al seleccionar un nuevo horario
                        });
                    }
                    timeSlotsEl.appendChild(timeSlotEl);
                });
            } catch (error) {
                console.error('Error al cargar horarios disponibles:', error);
                timeSlotsEl.innerHTML = `<p class="text-red-500">Error al cargar horarios: ${error.message}.</p>`;
            }
        }

        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // Modificación del DOMContentLoaded para cargar horarios iniciales
        document.addEventListener('DOMContentLoaded', async () => {
            await renderCalendar(); // Espera a que el calendario se renderice y se obtengan los turnos ocupados

            // Selecciona la fecha de hoy por defecto y carga sus horarios
            const today = new Date();
            const formattedToday = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            selectedDateInput.value = formattedToday; 
            displaySelectedDateEl.textContent = today.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });
            
            // *** LLAMADA ACTUALIZADA A fetchTimeSlots EN DOMContentLoaded ***
            await fetchTimeSlots(formattedToday); 
        });

        // Form submission logic
        appointmentForm.addEventListener('submit', async function (event) {
            event.preventDefault();

            // Validación previa: verificar campos obligatorios
            if (!selectedDateInput.value || !selectedTimeInput.value) {
                formMessageEl.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                formMessageEl.classList.add('bg-red-100', 'text-red-700');
                formMessageEl.textContent = 'Por favor, selecciona una fecha y una hora.'; // Mensaje más específico
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/appointments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nombre: document.getElementById('name').value,
                        telefono: document.getElementById('telefono').value,
                        servicio: document.getElementById('service').value,
                        fecha: selectedDateInput.value,
                        hora: selectedTimeInput.value,
                        message: document.getElementById('message').value
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    this.reset();
                    selectedDateInput.value = '';
                    selectedTimeInput.value = '';
                    // Vuelve a renderizar el calendario para actualizar la disponibilidad
                    await renderCalendar(); 

                    formMessageEl.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-blue-100', 'text-blue-700');
                    formMessageEl.classList.add('bg-green-100', 'text-green-700');
                    formMessageEl.textContent = 'Cita agendada con éxito. ¡Gracias por tu reserva!';
                } else {
                    formMessageEl.classList.remove('hidden', 'bg-blue-100', 'text-blue-700', 'bg-green-100', 'text-green-700');
                    formMessageEl.classList.add('bg-red-100', 'text-red-700');
                    formMessageEl.textContent = result.error || 'Error al agendar la cita. Por favor, intenta de nuevo.';
                    console.error('Error al agendar:', result.error || 'Error desconocido');
                }

            } catch (error) {
                console.error('Error de red o de servidor:', error);
                formMessageEl.classList.remove('hidden', 'bg-blue-100', 'text-blue-700', 'bg-green-100', 'text-green-700');
                formMessageEl.classList.add('bg-red-100', 'text-red-700');
                formMessageEl.textContent = 'Error de conexión. Asegúrate de que el servidor esté activo e intenta de nuevo.';
            }
        });
    </script>
</body>
</html>